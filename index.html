<!doctype html>
<html lang="en-us">
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />

		<title>Sonic the Hedgehog</title>

		<link type="text/css" rel="stylesheet" href="css/fonts.css" />
		<style type="text/css">
			html, body {
				font-family: arial, sans-serif;
				margin: 0;
				padding: 0;
				width: 100%;
				height: 100%;
				overflow: hidden;
				background-color: #000;
				text-align: center;
			}

			canvas {
				height: 100%;
				margin: auto;
				padding: 0;
				border: 0 none;
				background-color: #000;
				-ms-interpolation-mode: nearest-neighbor;
				image-rendering: optimizeSpeed;
				image-rendering: -webkit-optimize-contrast;
				image-rendering: -moz-crisp-edges;
				image-rendering: -o-crisp-edges;
				image-rendering: crisp-edges;
				image-rendering: pixelated;
			}

			.spinner {
				height: 30px;
				width: 30px;
				margin: 20px 0 0 20px;
				display: inline-block;
				vertical-align: top;

				-webkit-animation: rotation .8s linear infinite;
				-moz-animation: rotation .8s linear infinite;
				-o-animation: rotation .8s linear infinite;
				animation: rotation 0.8s linear infinite;

				border-left: 5px solid rgb(235, 235, 235);
				border-right: 5px solid rgb(235, 235, 235);
				border-bottom: 5px solid rgb(235, 235, 235);
				border-top: 5px solid rgb(120, 120, 120);

				border-radius: 100%;
				background-color: rgb(189, 215, 46);
			}

			@-webkit-keyframes rotation {
				from {
					-webkit-transform: rotate(0deg);
				}
				to {
					-webkit-transform: rotate(360deg);
				}
			}

			@-moz-keyframes rotation {
				from {
					-moz-transform: rotate(0deg);
				}
				to {
					-moz-transform: rotate(360deg);
				}
			}

			@-o-keyframes rotation {
				from {
					-o-transform: rotate(0deg);
				}
				to {
					-o-transform: rotate(360deg);
				}
			}

			@keyframes rotation {
				from {
					transform: rotate(0deg);
				}
				to {
					transform: rotate(360deg);
				}
			}

			#status {
				display: inline-block;
				vertical-align: top;
				margin-top: 30px;
				margin-left: 20px;
				font-weight: bold;
				color: rgb(120, 120, 120);
			}

			#progress {
				height: 20px;
				width: 300px;
			}

			#output {
				width: 100%;
				height: 200px;
				margin: 10px auto 0;
				border-left: 0;
				border-right: 0;
				padding-left: 0;
				padding-right: 0;
				display: block;
				background-color: black;
				color: white;
				font-family: 'Lucida Console', Monaco, monospace;
				outline: none;
			}

			.context-menu div {
				cursor: pointer;
			}
		</style>
	</head>
	<body>
		<div class="spinner" id="spinner" style="display: none;"></div>
		<div id="status" style="display: none;">Downloading...</div>
		<progress id="progress" value="0" max="100" hidden="hidden"></progress>
		<canvas id="canvas" onclick="window.focus();" oncontextmenu="event.preventDefault();"></canvas>
		<textarea id="output" style="display: none;" rows="8"></textarea>

		<button id="playButton" onclick="startGame()">Play</button>
		<input type="file" id="modsInput" style="display: none;" onchange="uploadMod(this)" />

		<script type="text/javascript">
			var modsList = [];

			function startGame() {
				Module.setStatus('Loading references...');
				loadIndexJS();
			}

			function uploadMod(input) {
				var file = input.files[0];
				if (file) {
					console.log('Uploading mod:', file.name);
					modsList.push({ fileName: file.name });
					updateModsList();
				}
			}

			document.addEventListener('contextmenu', function (event) {
				event.preventDefault();
				var modElement = event.target.closest('.mod');
				if (modElement) {
					showContextMenu(modElement);
				}
			});

			function deleteMod(modFileName) {
				console.log('Deleting mod:', modFileName);
				modsList = modsList.filter(mod => mod.fileName !== modFileName);
				updateModsList();
			}

			function updateModsList() {
				var outputElement = document.getElementById('output');
				outputElement.value = modsList.map(mod => mod.fileName).join('\n');
			}

			function showContextMenu(modElement) {
				var menu = document.createElement('div');
				menu.className = 'context-menu';
				menu.innerHTML = '<div onclick="deleteMod(\'' + modElement.dataset.fileName + '\')">Delete</div>';
				document.body.appendChild(menu);
				menu.style.position = 'absolute';
				menu.style.left = event.pageX + 'px';
				menu.style.top = event.pageY + 'px';

				document.addEventListener('click', function closeContextMenu() {
					menu.remove();
					document.removeEventListener('click', closeContextMenu);
				});
			}

			function loadIndexJS() {
				console.log('Loading index.js');
				var script = document.createElement('script');
				script.type = 'text/javascript';
				script.src = 'index.js';
				document.body.appendChild(script);
			}
		</script>
	</body>
</html>